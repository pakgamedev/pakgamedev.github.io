<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pakistan Game Dev Club</title>
    <meta property="og:title" content="Pakistan Game Dev Club">
    <meta property="og:image" content="https://pakgamedev.com/files/preview.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://pakgamedev.com/files/preview.png">
    <meta property="og:description" content="Play one new game every week. Head over to our discord server for discussions.">
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Pak Game Dev Club" />
    <link rel="manifest" href="/site.webmanifest" />
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #0f172a;
            color: white;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #22c55e; border-radius: 4px; }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-panel:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(34, 197, 94, 0.5);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
            transform: scale(1.02);
        }

        .bg-animated {
            background: linear-gradient(-45deg, #022c22, #0f172a, #1a2e05, #000000);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 50;
            opacity: 0.3;
        }

        .text-glow { text-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        
        .no-filter {
        image-rendering: -webkit-optimize-contrast; /* webkit */
	image-rendering: -moz-crisp-edges /* Firefox */

        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js';
        import { getFirestore, collection, doc, onSnapshot, query } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';

        // PLACE YOUR CONFIG HERE
        const firebaseConfig = {
          apiKey: "AIzaSyDqvti-PChTusPiGL0CsGndzR6ppz_ls5c",
	  authDomain: "pakgamedev-com.firebaseapp.com",
	  projectId: "pakgamedev-com",
	  storageBucket: "pakgamedev-com.firebasestorage.app",
	  messagingSenderId: "482266938106",
	  appId: "1:482266938106:web:bad5c2745289a25b246743"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = firebaseConfig['appId'];

        window.FB = { auth, db, appId, signInAnonymously, onAuthStateChanged, collection, doc, onSnapshot, query };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
	
	const CurrentGameHero = ({ user }) => {
            const [currentGame, setCurrentGame] = useState(null);

            useEffect(() => {
                if (!user) return;
                const { db, appId, doc, onSnapshot } = window.FB;
                
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'current', 'game');
                const unsubscribe = onSnapshot(docRef, (snapshot) => {
                    if (snapshot.exists()) {
                        setCurrentGame(snapshot.data());
                    }
                }, (err) => console.error("Current Game error", err));

                return () => unsubscribe();
            }, [user]);
            
            if (!currentGame) {
                return (
                    <section className="relative w-full h-[400px] md:h-[500px] rounded-3xl overflow-hidden border-white/5 flex flex-col items-center justify-center p-8 text-center hero-glow border-green-500/20">
                        <div className="absolute inset-0 z-0 bg-black/40">
                            <div className="w-full h-full opacity-10 bg-[radial-gradient(#22c55e_1px,transparent_1px)] [background-size:20px_20px] animate-[pulse_4s_infinite]"></div>
                        </div>
                        <div className="relative z-10 space-y-6">
                            <div className="w-24 h-24 mx-auto bg-white/5 rounded-full flex items-center justify-center border border-white/10 shadow-[0_0_30px_rgba(255,255,255,0.05)]">
                                <i className="fa-solid fa-microchip text-4xl text-gray-500 animate-pulse"></i>
                            </div>
                            <h2 
                                className="text-3xl md:text-5xl font-bold tracking-tighter uppercase glitch-text relative" 
                                data-text="Next game is being chosen."
                            >
                                Next game is being chosen.
                            </h2>
                            <p className="text-green-500 font-mono text-sm tracking-[0.3em] uppercase opacity-70">
                                It'll be ready by the Monday morning.
                            </p>
                            <div className="pt-4 flex justify-center gap-1">
                                <span className="w-2 h-1 bg-green-500/40 animate-bounce"></span>
                                <span className="w-2 h-1 bg-green-500/40 animate-bounce [animation-delay:0.2s]"></span>
                                <span className="w-2 h-1 bg-green-500/40 animate-bounce [animation-delay:0.4s]"></span>
                            </div>
                        </div>
                    </section>
                );
            }

            return (
                <section className="relative w-full h-[400px] md:h-[500px] rounded-3xl overflow-hidden border-green-500/20 group hero-glow">
                    {/* Background Header Image */}
                    <div className="absolute inset-0 z-0">
                        <img 
                            src={currentGame.header_image} 
                            className="w-full h-full object-cover opacity-50 group-hover:scale-105 transition-transform duration-1000" 
                            alt=""
                        />
                        <div className="absolute inset-0 bg-gradient-to-t from-[#0f172a] via-[#0f172a]/40 to-transparent"></div>
                        <div className="absolute inset-0 bg-gradient-to-r from-[#0f172a] via-transparent to-transparent"></div>
                    </div>

                    {/* Content */}
                    <div className="relative z-10 h-full flex flex-col justify-end p-8 md:p-12">
                        <div className="space-y-6 max-w-2xl">
                            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-green-500/20 border border-green-500/30 text-green-400 text-xs font-bold tracking-[0.2em] uppercase">
                                <span className="relative flex h-2 w-2">
                                    <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span className="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                                </span>
                                Now Playing
                            </div>

                            {/* Library Logo or Name */}
                            {currentGame.library_logo ? (
                                <img 
                                    src={currentGame.library_logo} 
                                    className="text-7xl md:text-8xl font-bold uppercase tracking-tighter text-glow h-20 md:h-32 object-contain filter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]" 
                                    alt={currentGame.name} 
                                />
                            ) : (
                                <h2 className="text-5xl md:text-7xl font-bold uppercase tracking-tighter text-glow">
                                    {currentGame.name}
                                </h2>
                            )}

                            <div className="flex flex-wrap items-center gap-4 pt-4">
                                <a 
                                    href={currentGame.url} 
                                    target="_blank" 
                                    className="px-8 py-3 bg-green-600 hover:bg-green-500 text-black font-bold uppercase tracking-widest rounded-lg transition-all transform hover:scale-105 active:scale-95 shadow-[0_0_20px_rgba(22,163,74,0.4)]"
                                >
                                    Launch Project
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* Subtle Scanline Overlay for Section Only */}
                    <div className="absolute inset-0 pointer-events-none opacity-20 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%]"></div>
                </section>
            );
        };
        
        const QueuedGames = ({ user }) => {
            const [games, setGames] = useState([]);
            

            useEffect(() => {
                if (!user) return;
                const { db, appId, collection, onSnapshot } = window.FB;
                
                // Using the specific path structure provided
                const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'games');
                
                const unsubscribe = onSnapshot(colRef, (snapshot) => {
                    const gamesList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    setGames(gamesList);
                }, (err) => console.error("Firestore error", err));

                return () => unsubscribe();
            }, [user]);

            if (games.length === 0) return null;

            return (
                <section className="mt-16">
                    <div className="flex items-end justify-between mb-6 px-1">
                        <h3 className="text-xl font-bold tracking-widest uppercase border-l-4 border-green-500 pl-3 text-glow">Queued Games</h3>
                    </div>
                    <div className="grid grid-cols-10 sm:grid-cols-[repeat(16,_minmax(0,_1fr))] md:grid-cols-[repeat(18,_minmax(0,_1fr))] lg:grid-cols-[repeat(20,_minmax(0,_1fr))] gap-1 md:gap-2">
                        {games.map((game) => (
                            <a href={game.url} target="_blank" key={game.doc_id} className="group relative aspect-square glass-panel rounded-lg overflow-hidden cursor-pointer">
                                <img 
                                    src={game.icon_image || 'https://via.placeholder.com/150'} 
                                    alt={game.name}
                                    className="no-filter w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                                />
                                <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center p-2">
                                    <p className="text-[10px] text-center font-bold uppercase leading-tight">{game.name}</p>
                                </div>
                            </a>
                        ))}
                    </div>
                </section>
            );
        };


        const App = () => {
            const [currentTime, setCurrentTime] = useState(new Date());

            // Function to safely check localStorage for a seed, or create a new one.
            const getOrCreateAvatarSeed = () => {
                const storageKey = 'pakgamedev_avatarSeed';
                
                // Use a try/catch block for safer localStorage access
                try {
                    let seed = localStorage.getItem(storageKey);
                    if (!seed) {
                        // If no seed exists, generate a new one
                        seed = Math.random().toString(36).substring(2);
                        localStorage.setItem(storageKey, seed);
                    }
                    return seed;
                } catch (error) {
                    // Fallback if localStorage is unavailable or throws an error
                    console.error("Could not access localStorage. Using temporary random seed.", error);
                    return Math.random().toString(36).substring(2);
                }
            };
            
            // Initialize the state by calling the function
            const [avatarSeed] = useState(getOrCreateAvatarSeed);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 60000);
                return () => clearInterval(timer);
            }, []);
	    

            const formatTime = (date) => {
                return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

	    const [user, setUser] = useState(null);

            useEffect(() => {
                const { auth, db, signInAnonymously, onAuthStateChanged, collection, onSnapshot } = window.FB;
                
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (e) { console.error("Auth failed", e); }
                };
                initAuth();

                const unsubAuth = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                });

                return () => unsubAuth();
            }, []);
            
            return (
                <div className="relative min-h-screen text-white selection:bg-green-500 selection:text-black">
                    <div className="bg-animated"></div>
                    <div className="scanlines"></div>
                    
                    {/* Top Navigation Bar */}
                    <nav className="relative z-10 flex items-center justify-between px-8 py-6 backdrop-blur-sm bg-black/20 border-b border-white/5">
                        <a href="/" className="flex items-center gap-4">
                            <div className="w-10 h-10 bg-green-600 rounded flex items-center justify-center font-bold text-xl shadow-[0_0_15px_rgba(22,163,74,0.6)]">
                                <img className="rounded" src="https://styles.redditmedia.com/t5_ckbq64/styles/communityIcon_ooei9a15xprd1.png"/>
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold tracking-wider uppercase">Pak Game Dev</h1>
                                <p className="text-xs text-green-400 tracking-[0.2em] uppercase">Community Hub</p>
                            </div>
                        </a>

                        <div className="flex items-center gap-4 text-xl font-light">
                            <i className="fa-solid fa-wifi text-xs text-green-500"></i>
                            <span className="text-lg tracking-wider">{formatTime(currentTime)}</span>
                            <div className="w-8 h-8 rounded-full bg-gray-700 overflow-hidden border border-gray-500">
                                <img src={`https://api.dicebear.com/9.x/thumbs/svg?seed=${avatarSeed}`} alt="User" />
                            </div>
                        </div>
                    </nav>

                    <main className="relative z-10 p-4 md:p-10 max-w-7xl mx-auto space-y-16">
                        <section className="mb-8">
                            <h2 className="text-4xl md:text-6xl font-bold mb-2 uppercase">
                                Game Dev <span className="text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-green-600">Club</span>
                            </h2>
                            <p className="text-gray-400 text-lg max-w-2xl">
                                Play one new game every week. Head over to our discord server for discussions.
                            </p>
                        </section>

			            <CurrentGameHero user={user} />
                        <QueuedGames user={user} />

                        
                        {/* Footer / Status Bar */}
                        <footer className="mt-12 py-8 border-t border-white/5 flex flex-col md:flex-row justify-between items-center text-gray-500 text-sm">
                            <div className="flex gap-6 mb-4 md:mb-0">
                                <a href="#" className="hover:text-white transition">Privacy</a>
                                <a href="#" className="hover:text-white transition">Terms</a>
                                <a href="#" className="hover:text-white transition">Contact</a>
                            </div>
                            <div className="flex items-center gap-2">
                                <span>SYSTEM STATUS:</span>
                                <span className="text-green-500 font-bold">ONLINE</span>
                                <span className="w-2 h-2 bg-green-500 rounded-full animate-ping ml-1"></span>
                            </div>
                            <div className="mt-4 md:mt-0">
                                &copy; 2025 Pak Game Dev Community.
                            </div>
                        </footer>

                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
